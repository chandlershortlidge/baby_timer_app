<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Nap Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Ccircle cx='12' cy='12' r='10' fill='%237c3aed'/%3E%3Cpath fill='%23ffffff' d='M9 8h6v2h-4v2h4v2H9v-2h4v-2H9Z'/%3E%3C/svg%3E" />
  <!-- Dev: CDN is fine. (For prod, build Tailwind) -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-gray-50 to-blue-50/30 text-gray-800">
  <div class="max-w-md mx-auto min-h-screen p-4 space-y-6">

    <section id="sleep-summary" class="rounded-3xl bg-white shadow-lg p-6 space-y-6">
      <header class="flex items-start justify-between">
        <div class="flex items-start gap-3">
          <div id="sleep-state-icon" class="flex h-12 w-12 items-center justify-center rounded-full bg-amber-100 text-amber-500">
            <svg id="awake-icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" class="h-7 w-7">
              <path d="M12 18a6 6 0 1 0 0-12 6 6 0 0 0 0 12Zm0-14a1 1 0 0 1 1-1h0a1 1 0 1 1-2 0h0a1 1 0 0 1 1-1ZM12 21a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm9-9a1 1 0 1 1 0 2 1 1 0 0 1 0-2ZM3 12a1 1 0 1 1 0 2 1 1 0 0 1 0-2Zm14.95-6.364a1 1 0 1 1 1.414 1.414 1 1 0 0 1-1.414-1.414ZM4.636 18.364a1 1 0 1 1 1.414 1.414 1 1 0 0 1-1.414-1.414Zm14.142 1.414a1 1 0 1 1-1.414-1.414 1 1 0 0 1 1.414 1.414ZM6.05 5.636A1 1 0 1 1 4.636 4.222 1 1 0 0 1 6.05 5.636Z"/>
            </svg>
            <svg id="asleep-icon" class="hidden h-7 w-7" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M21 12.79A9 9 0 1 1 11.21 3c.2 0 .41.01.61.03a7 7 0 0 0 9.15 9.15c.02.2.03.41.03.61Z"/>
            </svg>
          </div>
          <div>
            <p id="sleep-state-text" class="text-xl font-bold text-amber-700">Baby is awake</p>
            <p id="sleep-state-subtext" class="text-sm text-amber-600">Next nap at</p>
          </div>
        </div>
        <div class="text-right">
          <p id="sleep-state-time" class="text-4xl font-extrabold text-amber-700">--:--</p>
        </div>
      </header>

      <p id="sleep-meta" class="text-xs text-gray-500">Down at — • Woke at —</p>

      <div class="grid grid-cols-2 gap-4">
        <div class="rounded-2xl bg-blue-50 p-4">
          <p class="text-xs font-medium text-blue-700 flex items-center gap-2">
            <span class="inline-flex h-6 w-6 items-center justify-center rounded-full bg-blue-100 text-blue-600">☀️</span>
            Awake today
          </p>
          <p id="awake-today" class="mt-1 text-2xl font-semibold text-blue-900">--</p>
        </div>
        <div class="rounded-2xl bg-violet-50 p-4">
          <p class="text-xs font-medium text-violet-700 flex items-center gap-2">
            <span class="inline-flex h-6 w-6 items-center justify-center rounded-full bg-violet-100 text-violet-600">💤</span>
            Total nap time
          </p>
          <p id="total-nap-today" class="mt-1 text-2xl font-semibold text-violet-900">--</p>
        </div>
      </div>

      <div>
        <div class="flex justify-between text-xs text-gray-500">
          <span>Awake budget</span>
          <span id="awake-budget-label">--</span>
        </div>
        <div class="mt-2 h-3 rounded-full bg-gray-200">
          <div id="awake-budget-bar" class="h-full rounded-full bg-emerald-500" style="width: 0%;"></div>
        </div>
      </div>

      <div id="nap-alarm-panel" class="rounded-2xl border border-indigo-100 bg-indigo-50/60 p-4">
        <div class="flex items-start justify-between">
          <div>
            <p class="text-sm font-semibold text-indigo-700">Nap Alarm</p>
            <p class="text-xs text-indigo-500">Get notified before nap time</p>
          </div>
          <span class="text-indigo-500" aria-hidden="true">🔔</span>
        </div>

        <div id="nap-alarm-timing" class="mt-4 rounded-xl bg-white/80 p-3 shadow-inner">
          <div class="flex items-center justify-between text-sm text-gray-700">
            <span>Next nap</span>
            <span id="nap-next-time" class="font-semibold text-gray-900">—</span>
          </div>
          <div class="mt-2 flex items-center justify-between text-sm text-gray-700">
            <span>Alarm fires at</span>
            <div class="flex items-center gap-2">
              <span id="nap-alarm-fire-dot" class="h-2 w-2 rounded-full bg-emerald-500"></span>
              <span id="nap-alarm-fire-time" class="font-semibold text-gray-900">—</span>
            </div>
          </div>
        </div>

        <div id="nap-alarm-sound-row" class="mt-4 flex flex-wrap items-center justify-between gap-3 rounded-xl border border-indigo-100 bg-white p-3 text-sm text-gray-700">
          <span class="font-medium text-indigo-600">Sound</span>
          <div class="flex flex-wrap items-center gap-3">
            <button id="alarm-sound-toggle" type="button" class="rounded-lg border border-indigo-200 px-3 py-1 text-sm font-semibold text-indigo-600">On</button>
            <select id="alarm-sound-select" class="w-32 rounded-lg border border-indigo-200 bg-white px-2 py-1 text-sm text-gray-700">
              <option>Chirp</option>
              <option>Marimba</option>
              <option>Bell</option>
            </select>
            <button id="alarm-sound-test" type="button" class="text-sm font-semibold text-indigo-600 underline decoration-dotted decoration-1 underline-offset-2">Test</button>
          </div>
        </div>

        <div id="nap-alarm-controls" class="mt-4 flex flex-wrap items-center justify-between gap-3 rounded-xl border border-indigo-100 bg-white p-3 text-sm text-gray-700">
          <span class="text-indigo-600">Notify me</span>
          <select id="nap-alarm-lead" class="w-36 rounded-lg border border-indigo-200 bg-white px-2 py-1 text-sm text-gray-700">
            <option>30 seconds</option>
            <option>1 minute</option>
            <option>5 minutes</option>
            <option>10 minutes</option>
            <option>15 minutes</option>
            <option>20 minutes</option>
            <option>30 minutes</option>
          </select>
          <span id="nap-alarm-context" class="text-indigo-600">before nap</span>
        </div>
      </div>

      <div class="space-y-4">
        <div id="nap-reminder-row" class="flex items-start justify-between text-sm text-gray-700">
          <div>
            <span class="font-semibold">Nap alarm</span>
            <p id="nap-reminder-helper" class="mt-1 hidden text-xs text-gray-500"></p>
            <button id="nap-reminder-sound-toggle"
                    type="button"
                    class="mt-1 hidden text-xs font-medium text-indigo-600 underline decoration-dotted decoration-1 underline-offset-2">
              Sound on
            </button>
            <button id="nap-audio-hint"
                    type="button"
                    class="mt-1 hidden text-xs font-medium text-amber-600 underline decoration-dotted decoration-1 underline-offset-2">
              Tap to enable sound
            </button>
          </div>
          <button id="nap-reminder-btn"
                  type="button"
                  class="flex h-11 min-w-[150px] items-center justify-between rounded-xl bg-white px-4 font-semibold text-indigo-600 shadow-sm ring-1 ring-indigo-200 transition disabled:cursor-not-allowed disabled:opacity-60"
                  style="font-variant-numeric: tabular-nums;">
            <span id="nap-reminder-text">--</span>
            <span aria-hidden="true">⌄</span>
          </button>
        </div>
      </div>

      <div id="end-reminder-actions" class="hidden">
        <div class="flex items-center justify-between rounded-xl bg-indigo-100/70 px-4 py-2 text-sm text-indigo-800">
          <span class="font-semibold">Reminder fired</span>
          <div class="flex items-center gap-3">
            <button id="end-reminder-snooze" type="button" class="rounded-lg bg-white px-3 py-1 font-semibold text-indigo-700 shadow hover:bg-indigo-50">Snooze 2 min</button>
            <button id="end-reminder-dismiss" type="button" class="rounded-lg bg-white/70 px-3 py-1 font-semibold text-indigo-700 hover:bg-white">Dismiss</button>
          </div>
        </div>
      </div>

      <button id="nap-control-btn"
        class="w-full bg-green-500 text-white font-bold py-4 px-6 rounded-2xl shadow-lg hover:bg-green-600 transition-colors">
        Start Nap
      </button>
      <p id="nap-helper-text" class="hidden text-sm text-gray-500">End bedtime first.</p>
    </section>

    <!-- Nap timer -->
    <div id="nap-timer-container" class="hidden rounded-3xl bg-indigo-50 p-6 text-center shadow-lg">
      <div id="nap-timer-display" class="text-7xl font-extrabold tracking-tight text-indigo-800">45:00</div>
      <p class="mt-2 text-sm text-indigo-600">
        Reminder: Alarm sounds <span class="underline">1 minute</span> before nap ends.
      </p>
    </div>

    <!-- Schedule card -->
    <div class="rounded-3xl bg-white shadow-lg p-4">
      <div id="schedule-header" class="flex items-center justify-between">
        <button id="schedule-toggle-btn" type="button" class="flex flex-1 items-center gap-2 text-left">
          <div class="w-5 h-5 rounded-md bg-blue-100 flex items-center justify-center">
            <span class="text-blue-600 text-sm">🗓️</span>
          </div>
          <h2 class="text-lg font-semibold">Today's Schedule</h2>
        </button>
        <div class="flex items-center gap-3">
          <button id="schedule-edit-btn" type="button" class="text-sm font-semibold text-indigo-600 underline decoration-dotted decoration-1 underline-offset-2">Edit</button>
          <button id="schedule-toggle-icon" type="button" aria-label="Toggle schedule" class="rounded-md p-1 text-lg transition-transform">⌄</button>
        </div>
      </div>

      <div id="schedule-summary" class="mt-1 text-sm text-gray-600">
        <!-- filled by JS: “4 naps remaining • Next: 9:30 AM” -->
      </div>

      <ul id="schedule-list" class="mt-4 space-y-3">
        <!-- JS renders items here; each li gets an Edit button with class 'edit-nap-btn' -->
      </ul>
    </div>
  </div>

  <!-- Edit Nap Modal -->
  <div id="edit-nap-modal" class="fixed inset-0 z-50 hidden" role="dialog" aria-modal="true" aria-labelledby="edit-modal-title">
    <div class="absolute inset-0 bg-black/50" data-edit-overlay></div>
    <div class="relative mx-auto mt-24 w-11/12 max-w-md rounded-2xl bg-white p-6 shadow-xl">
      <h3 id="edit-modal-title" class="text-lg font-semibold text-gray-800">Edit Nap Duration</h3>
      <label for="edit-nap-duration-input" class="mt-4 block text-sm text-gray-600">Duration (minutes)</label>
      <input id="edit-nap-duration-input" type="number" min="1" step="1"
             class="mt-1 w-full rounded-xl border border-gray-300 p-3 focus:outline-none focus:ring"
             placeholder="e.g. 45" />
      <div class="mt-6 flex justify-end gap-3">
        <button id="cancel-edit-btn" class="rounded-xl bg-gray-100 px-4 py-2 text-gray-700 hover:bg-gray-200">Cancel</button>
        <button id="save-edit-btn" class="rounded-xl bg-blue-600 px-4 py-2 font-semibold text-white hover:bg-blue-700">Save</button>
      </div>
    </div>
  </div>

    <footer id="bedtime-footer" class="sticky bottom-4 mt-6 rounded-3xl bg-white p-4 shadow-lg">
      <div class="space-y-3">
        <p id="bedtime-helper" class="text-sm text-gray-500">Start bedtime when you're ready to log night sleep.</p>
        <button id="bedtime-btn"
                class="relative flex w-full items-center justify-center gap-2 rounded-2xl bg-purple-600 px-6 py-4 text-lg font-semibold text-white shadow-lg transition disabled:cursor-not-allowed disabled:opacity-60">
          <span id="bedtime-btn-label">Start Bedtime</span>
          <span id="bedtime-press-indicator" class="absolute inset-0 rounded-2xl border-2 border-white/40 opacity-0 transition"></span>
        </button>
      </div>
    </footer>
  </div>

  <!-- External JS (the single source of truth) -->
  <script src="{{ url_for('static', filename='js/script.js') }}"></script>

  <audio id="alarm-audio" preload="auto" class="hidden">
    <source src="{{ url_for('static', filename='audio/alarm.ogg') }}" type="audio/ogg">
    <source src="{{ url_for('static', filename='audio/alarm.mp3') }}" type="audio/mpeg">
    <source src="{{ url_for('static', filename='audio/alarm.wav') }}" type="audio/wav">
  </audio>
  <div
    id="toast-root"
    role="status"
    aria-live="polite"
    class="pointer-events-none fixed inset-x-0 bottom-24 z-50 flex justify-center px-4"
  ></div>
  <div id="toast-container" class="pointer-events-none fixed inset-x-0 top-4 z-50 flex flex-col items-center space-y-2"></div>
  <div id="aria-live-region" class="sr-only" aria-live="polite"></div>

  <div id="end-reminder-modal" class="fixed inset-0 z-50 hidden" role="dialog" aria-modal="true" aria-labelledby="end-reminder-title">
    <div class="absolute inset-0 bg-black/50" data-end-reminder-overlay></div>
    <div class="relative mx-auto mt-24 w-11/12 max-w-md rounded-2xl bg-white p-6 shadow-xl">
      <h3 id="end-reminder-title" class="text-lg font-semibold text-gray-800">End-of-nap reminder</h3>
      <div id="end-reminder-options" class="mt-4 space-y-2" role="radiogroup" aria-labelledby="end-reminder-title"></div>
      <label class="mt-4 flex items-center gap-2 text-sm text-gray-700">
        <input id="end-reminder-oneoff" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" checked />
        This nap only
      </label>
      <p id="end-reminder-modal-helper" class="mt-2 text-xs text-gray-500">Changes apply to this nap unless you turn off the toggle.</p>
      <div class="mt-6 flex justify-end gap-3">
        <button id="end-reminder-cancel" class="rounded-xl bg-gray-100 px-4 py-2 text-gray-700 hover:bg-gray-200" type="button">Cancel</button>
        <button id="end-reminder-save" class="rounded-xl bg-indigo-600 px-4 py-2 font-semibold text-white hover:bg-indigo-700" type="button">Save</button>
      </div>
    </div>
  </div>
</body>
</html>
